<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Quiz des Baies - Expert (QCM)</title>
  <style>
    :root{
      --bg:#f7f7f7; --card:#fff; --primary:#2d8f6f; --accent:#2980b9;
      --muted:#666;
    }
    body{
      margin:0; font-family:Arial,Helvetica,sans-serif; background:var(--bg); color:#222;
      display:flex; align-items:flex-start; justify-content:center; padding:20px;
    }
    .wrap{ width:100%; max-width:480px; background:var(--card); border-radius:12px; padding:18px; box-shadow:0 6px 20px rgba(0,0,0,0.08); }
    h1{ margin:6px 0 10px; font-size:1.25rem; text-align:center; }
    h2{ margin:12px 0 6px; font-size:1.05rem; color:var(--accent); }
    p.lead{ margin:6px 0 12px; color:var(--muted); font-size:0.95rem; }
    img.illus{ display:block; max-width:260px; width:90%; height:auto; margin:10px auto; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
    .options{ display:flex; flex-direction:column; gap:8px; margin-top:8px; }
    .opt-btn{
      padding:12px 10px; border-radius:8px; border:0; cursor:pointer;
      background:var(--accent); color:#fff; font-size:1rem; transition:transform .12s, opacity .12s;
    }
    .opt-btn:hover{ transform:translateY(-2px); }
    .opt-btn[disabled]{ opacity:.6; cursor:not-allowed; transform:none; }
    #explanation{ margin-top:12px; font-size:0.95rem; color:var(--muted); min-height:42px; }
    #progress{ height:10px; background:#eee; border-radius:8px; overflow:hidden; margin-top:14px; }
    #progress > div{ height:100%; width:0%; background:var(--primary); transition:width .4s ease; }
    .center{ text-align:center; }
    .small{ font-size:0.9rem; color:var(--muted); }
  </style>
</head>
<body>
  <div class="wrap" id="game">
    <h1>üçá Quiz des Baies - Expert (QCM)</h1>
    <p class="lead center">20 questions techniques ‚Äî choisis la bonne r√©ponse. Explication affich√©e apr√®s ta s√©lection.</p>
    <div class="center"><button id="startBtn" class="opt-btn" style="max-width:240px;background:var(--primary);">Commencer</button></div>
  </div>

<script>
/* -------------------------
   QUESTIONS (remplace les img par tes fichiers locaux)
   index des r√©ponses : 0 = 1√®re option, 1 = 2·µâ option, 2 = 3·µâ option
   ------------------------- */
const quiz1 = [
  { q:"Le fruit du caf√©ier est...", options:["Une drupe","Une baie","Un ak√®ne"], correct:1, exp:"Le fruit du caf√©ier est une baie appel√©e ¬´ cerise de caf√© ¬ª. ", img:"cafe.jpg" },
  { q:"Le poivron est...", options:["Une baie","Une drupe","Un fruit sec"], correct:0, exp:"Le poivron, comme la tomate, est une baie botanique.", img:"poivron.jpg" },
  { q:"Le fruit du grenadier est...", options:["Une p√©ponide","Un balaustion","Une drupe"], correct:1, exp:"Le fruit du grenadier est appel√© balaustion.", img:"grenade.jpg" },
  { q:"La banane est...", options:["Une baie parth√©nocarpique","Un ak√®ne","Une drupe"], correct:0, exp:"Les bananes cultiv√©es sont parth√©nocarpique : baie sans graines fertiles.", img:"banane.jpg" },
  { q:"Le concombre est...", options:["Une drupe","Une p√©ponide","Un ak√®ne"], correct:1, exp:"Le concombre est une p√©ponide (sous-type de baie).", img:"concombre.jpg" },
  { q:"Le poivre noir est...", options:["Un fruit sec","Une baie s√©ch√©e","Une drupe miniature"], correct:1, exp:"Le poivre noir = petites baies s√©ch√©es.", img:"poivre.jpg" },
  { q:"Le fruit de l‚Äôaubergine est...", options:["Une drupe","Une baie charnue","Un ak√®ne"], correct:1, exp:"L‚Äôaubergine est une baie charnue.", img:"aubergine.jpg" },
  { q:"La tomate cerise et la tomate classique sont...", options:["Deux fruits de nature diff√©rente","Toutes deux des baies","L‚Äôune une drupe, l‚Äôautre une baie"], correct:1, exp:"Les deux sont des baies.", img:"tomate.jpg" },
  { q:"Le fruit du grenadier contient...", options:["Des arilles","Des drup√©oles","Des samares"], correct:0, exp:"Le grenadier poss√®de des arilles charnues entourant les graines.", img:"grenadier.jpg" },
  { q:"Le kiwi est...", options:["Une baie","Un ak√®ne","Une drupe"], correct:0, exp:"Le kiwi est une grosse baie charnue riche en vitamine C.", img:"kiwi.jpg" }
];

const quiz2 = [
  { q:"Les baies de sureau noir sont...", options:["Comestibles crues","Toxiques crues mais comestibles cuites","Toujours toxiques"], correct:1, exp:"Les baies de sureau doivent √™tre cuites avant consommation.", img:"sureau.jpg" },
  { q:"Les arilles rouges de l‚Äôif sont...", options:["Totalement comestibles","Comestibles sauf la graine","Toxiques m√™me sans la graine"], correct:1, exp:"Seule la pulpe est 'rouge' mais la graine est mortelle si ing√©r√©e.", img:"if.jpg" },
  { q:"Les myrtilles sauvages sont...", options:["Toujours libres de cueillette","Parfois prot√©g√©es r√©gionalement","Des fruits toxiques"], correct:1, exp:"Dans certaines r√©gions la cueillette des myrtilles sauvages est limit√©e.", img:"myrtille.jpg" },
  { q:"Les baies du gui sont...", options:["Comestibles","Toxiques","Utilis√©es en vin"], correct:1, exp:"Les baies du gui sont toxiques pour l'humain.", img:"gui.jpg" },
  { q:"La r√®gle en cueillette est...", options:["Tout cueillir","Partager entre soi, animaux et plante","Ne rien cueillir"], correct:1, exp:"Principe simple: pr√©lever avec parcimonie, laisser pour la faune et la r√©g√©n√©ration.", img:"regle.jpg" },
  { q:"Certaines baies toxiques...", options:["Deviennent comestibles apr√®s cuisson","Restent toxiques m√™me apr√®s cuisson","Ne sont jamais toxiques"], correct:1, exp:"Ex : baies d'if restent toxiques m√™me apr√®s cuisson.", img:"toxique.jpg" },
  { q:"Cueillir sur un terrain priv√© est...", options:["Toujours autoris√©","Interdit sans autorisation","Libre si non cl√¥tur√©"], correct:1, exp:"Toujours demander l'autorisation au propri√©taire.", img:"terrain.jpg" },
  { q:"Les oiseaux et animaux sauvages...", options:["Se nourrissent aussi de baies","N‚Äôen consomment jamais","Pr√©f√©rent uniquement les feuilles"], correct:0, exp:"La faune d√©pend fortement des baies selon la saison.", img:"oiseaux.jpg" },
  { q:"Les baies de belladone sont...", options:["Comestibles apr√®s cuisson","Toxiques mortelles","Utilis√©es comme fruit sec"], correct:1, exp:"Les baies de belladone sont tr√®s toxiques.", img:"belladone.jpg" },
  { q:"Il est prudent de go√ªter une baie inconnue...", options:["Toujours","Jamais","Seulement si elle est color√©e"], correct:1, exp:"Ne jamais go√ªter une baie inconnue; certaines sont mortelles.", img:"inconnue.jpg" }
];

const allQuizzes = [quiz1, quiz2];

let currentQuiz = 0;
let indexQ = 0;
let score = 0;
let answering = false; // emp√™che multi-clics
const gameDiv = document.getElementById('game');
const DELAY_MS = 3000; // d√©lai avant question suivante

// utility: safe number for progress
function getProgressPct() {
  const total = quiz1.length + quiz2.length;
  return Math.round(((currentQuiz * quiz1.length + indexQ) / total) * 100);
}

function renderStart() {
  gameDiv.innerHTML = `
    <h2>Pr√™t ?</h2>
    <p class="small">Clique sur Commencer pour d√©buter la partie 1 (botanique).</p>
    <div class="center"><button id="startNow" class="opt-btn" style="background:var(--primary); max-width:240px">Commencer</button></div>
  `;
  document.getElementById('startNow').addEventListener('click', () => {
    indexQ = 0; currentQuiz = 0; score = 0;
    showQuestion();
  });
}

function startGame() {
  indexQ = 0; currentQuiz = 0; score = 0;
  showQuestion();
}

function showQuestion() {
  answering = false;
  const quiz = allQuizzes[currentQuiz];
  if (indexQ >= quiz.length) {
    // fin de la partie actuelle
    if (currentQuiz === 0) return showTransition();
    else return showResult();
  }

  const q = quiz[indexQ];
  const progress = getProgressPct();

  // build options html but we'll attach listeners after injection
  let optionsHtml = `<div id="options" class="options">`;
  q.options.forEach((opt, i) => {
    optionsHtml += `<button class="opt-btn" data-index="${i}">${opt}</button>`;
  });
  optionsHtml += `</div>`;

  gameDiv.style.opacity = 0;
  setTimeout(() => {
    gameDiv.innerHTML = `
      <h2>Question ${currentQuiz * quiz1.length + indexQ + 1}</h2>
      <p>${q.q}</p>
      <img class="illus" src="${q.img}" alt="Illustration" onerror="this.style.display='none'">
      ${optionsHtml}
      <div id="explanation"></div>
      <div id="progress"><div style="width:${progress}%" ></div></div>
    `;
    gameDiv.style.opacity = 1;

    // add listeners for each option
    document.querySelectorAll('#options .opt-btn').forEach(btn=>{
      btn.addEventListener('click', () => {
        if (answering) return; // ignore si d√©j√† r√©pondu
        handleAnswer(parseInt(btn.getAttribute('data-index'), 10));
      });
    });

  }, 220);
}

function handleAnswer(choice) {
  const quiz = allQuizzes[currentQuiz];
  const q = quiz[indexQ];
  const explanationDiv = document.getElementById('explanation');
  const optionButtons = Array.from(document.querySelectorAll('#options .opt-btn'));

  answering = true;
  // disable buttons immediately
  optionButtons.forEach(b => b.disabled = true);

  // mark chosen button (visual feedback)
  const chosenBtn = optionButtons.find(b => parseInt(b.getAttribute('data-index'),10) === choice);
  if (choice === q.correct) {
    score++;
    if (chosenBtn) chosenBtn.style.background = '#27ae60'; // vert
    explanationDiv.innerHTML = `‚úÖ Bonne r√©ponse ‚Äî ${q.exp}`;
  } else {
    if (chosenBtn) chosenBtn.style.background = '#c0392b'; // rouge
    // highlight correct button
    const correctBtn = optionButtons.find(b => parseInt(b.getAttribute('data-index'),10) === q.correct);
    if (correctBtn) correctBtn.style.background = '#27ae60';
    explanationDiv.innerHTML = `‚ùå Mauvaise r√©ponse ‚Äî ${q.exp}`;
  }

  // passer √† la question suivante apr√®s DELAY_MS
  setTimeout(() => {
    indexQ++;
    // si on a fini la premi√®re s√©rie, afficher transition
    if (indexQ >= quiz.length) {
      if (currentQuiz === 0) return showTransition();
    }
    showQuestion();
  }, DELAY_MS);
}

function showTransition() {
  gameDiv.innerHTML = `
    <img class="illus" src="cueillette.jpg" alt="Illustration cueillette" onerror="this.style.display='none'">
    <h2>üëè Bravo ! Premi√®re partie termin√©e</h2>
    <p class="small">Pr√™t(e) pour la partie 2 : bonnes pratiques & toxicologie ?</p>
    <div class="center"><button id="start2" class="opt-btn" style="background:var(--primary); max-width:240px">Commencer la 2·µâ partie</button></div>
  `;
  document.getElementById('start2').addEventListener('click', () => {
    currentQuiz = 1;
    indexQ = 0;
    showQuestion();
  });
}

function showResult() {
  const total = quiz1.length + quiz2.length;
  gameDiv.innerHTML = `
    <h2>üéâ Fin du jeu ! üéâ</h2>
    <p>Ton score final : <strong>${score}/${total}</strong></p>
    <p class="small">${score >= 15 ? "Bravo, expert confirm√© ! üèÜ" : "Pas mal ‚Äî continue d'apprendre !"}</p>
    <div class="center"><button id="replay" class="opt-btn" style="max-width:220px;background:var(--primary)">Rejouer</button></div>
  `;
  document.getElementById('replay').addEventListener('click', () => {
    currentQuiz = 0; indexQ = 0; score = 0; showQuestion();
  });
}

// start button (initial)
document.getElementById('startBtn').addEventListener('click', () => {
  startGame();
});

// pour debug : log erreurs images (utile si mobile ne charge pas)
window.addEventListener('error', (e) => {
  if (e.target && e.target.tagName === 'IMG') {
    console.warn('Image failed to load:', e.target.src);
  }
}, true);
</script>
</body>
</html>


